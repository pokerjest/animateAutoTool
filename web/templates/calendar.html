{{ define "calendar.html" }}
{{ if not .SkipLayout }}{{ template "header.html" . }}{{ end }}

<div class="container mx-auto" x-data="{ currentTab: {{.Today}} }">
    <!-- Header -->
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary to-accent">
                追番日历
            </h1>
            <p class="text-gray-500 mt-2">查看本周更新的全部番剧</p>
        </div>
    </div>

    <!-- Error Message -->
    {{ if .Error }}
    <div class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-6 rounded shadow-sm" role="alert">
        <p class="font-bold">Error</p>
        <p>{{ .Error }}</p>
    </div>
    {{ else }}

    <!-- Weekday Tabs (Mobile/Tablet) -->
    <div class="lg:hidden mb-6 flex overflow-x-auto gap-2 pb-2 scrollbar-hide">
        {{ range .Calendar }}
        <button @click="currentTab = {{.Weekday.ID}}"
            :class="{'bg-primary text-white shadow-lg scale-105': currentTab === {{.Weekday.ID}}, 'bg-white text-gray-600 hover:bg-gray-50': currentTab !== {{.Weekday.ID}}}"
            class="px-4 py-2 rounded-full whitespace-nowrap transition-all duration-200 font-medium text-sm flex-shrink-0 border border-gray-100">
            {{ .Weekday.CN }}
        </button>
        {{ end }}
    </div>

    <!-- Calendar Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-7 gap-6">
        {{ range .Calendar }}
        <!-- Day Column -->
        <div class="flex flex-col gap-4" :class="{'hidden lg:flex': currentTab !== {{.Weekday.ID}} }">

            <!-- Day Header -->
            <div class="sticky top-0 z-10 py-3 glass-panel text-center border-b-2"
                :class="currentTab === {{.Weekday.ID}} ? 'border-primary text-primary' : 'border-transparent text-gray-500'">
                <h3 class="font-bold text-lg">{{ .Weekday.CN }}</h3>
            </div>

            <!-- Anime Cards -->
            <div class="flex flex-col gap-3">
                {{ range .Items }}
                <div
                    class="group relative bg-white/50 hover:bg-white rounded-xl overflow-hidden transition-all duration-300 hover:shadow-lg border border-white/20 hover:border-primary/20">
                    <div class="flex p-2 gap-3 h-24">
                        <!-- Cover -->
                        <div
                            class="w-16 h-full shrink-0 rounded-lg overflow-hidden relative shadow-sm group-hover:shadow-md transition-all">
                            <img src="{{ .Images.Grid }}" alt="{{ .NameCN }}"
                                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                                loading="lazy" onerror="this.src='/static/img/placeholder.png'">
                        </div>

                        <!-- Info -->
                        <div class="flex-1 flex flex-col justify-between min-w-0 py-1">
                            <div class="space-y-1">
                                <h4 class="font-bold text-sm text-gray-800 line-clamp-2 leading-tight group-hover:text-primary transition-colors"
                                    title="{{ .NameCN }}">
                                    {{ if .NameCN }}{{ .NameCN }}{{ else }}{{ .Name }}{{ end }}
                                </h4>
                                {{ if .Rating.Score }}
                                <div class="flex items-center gap-1">
                                    <span class="text-yellow-400 text-xs">★</span>
                                    <span class="text-xs text-gray-500 font-medium">{{ .Rating.Score }}</span>
                                </div>
                                {{ end }}
                            </div>

                            <!-- Search/Add Button -->
                            <div
                                class="flex justify-end opacity-0 group-hover:opacity-100 transition-opacity duration-200 translate-y-2 group-hover:translate-y-0">
                                <a href="/subscriptions?q={{ if .NameCN }}{{ .NameCN }}{{ else }}{{ .Name }}{{ end }}"
                                    class="p-1.5 bg-primary/10 text-primary rounded-lg hover:bg-primary hover:text-white transition-colors"
                                    title="去搜索订阅">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none"
                                        viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                    </svg>
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {{ end }}
            </div>
        </div>
        {{ end }}
    </div>

    {{ end }}
</div>

<style>
    .scrollbar-hide::-webkit-scrollbar {
        display: none;
    }

    .scrollbar-hide {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }
</style>

{{ if not .SkipLayout }}{{ template "footer.html" . }}{{ end }}
{{ end }}