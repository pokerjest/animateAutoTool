{{ define "backup_analyze.html" }}
<div class="bg-red-50 rounded-lg p-4 border border-red-100 animate-fade-in-up">
    <h4 class="font-semibold text-red-800 mb-3 flex items-center gap-2">
        <span>ğŸ“‹</span> å¤‡ä»½æ–‡ä»¶åˆ†æç»“æœ
    </h4>
    <div class="grid grid-cols-2 gap-4 text-sm mb-4">
        <div class="bg-white p-2 rounded border border-red-100">
            <div class="text-gray-500 text-xs">è®¢é˜…æ•°</div>
            <div class="font-bold text-gray-800">{{ .Stats.SubscriptionCount }}</div>
        </div>
        <div class="bg-white p-2 rounded border border-red-100">
            <div class="text-gray-500 text-xs">å†å²è®°å½•</div>
            <div class="font-bold text-gray-800">{{ .Stats.DownloadLogCount }}</div>
        </div>
        <div class="bg-white p-2 rounded border border-red-100">
            <div class="text-gray-500 text-xs">æœ¬åœ°ç•ªå‰§</div>
            <div class="font-bold text-gray-800">{{ .Stats.LocalAnimeCount }}</div>
        </div>
        <div class="bg-white p-2 rounded border border-red-100">
            <div class="text-gray-500 text-xs">æ–‡ä»¶å¤§å°</div>
            <div class="font-bold text-gray-800">{{ .Stats.DatabaseSize }}</div>
        </div>
    </div>

    {{ if .Stats.SubscriptionTitles }}
    <div class="mb-4">
        <div class="text-xs text-red-500 mb-1 font-semibold">å¤‡ä»½åŒ…å«çš„è®¢é˜…:</div>
        <div
            class="max-h-[100px] overflow-y-auto space-y-1 pr-1 custom-scrollbar bg-white/50 p-2 rounded border border-red-100">
            {{ range .Stats.SubscriptionTitles }}
            <div class="text-xs text-gray-700 truncate">â€¢ {{ . }}</div>
            {{ end }}
        </div>
    </div>
    {{ end }}

    <form hx-post="/api/backup/execute" hx-indicator="#confirm-btn">
        <input type="hidden" name="temp_file" value="{{ .TempFile }}">

        <!-- è¿˜åŸé€‰é¡¹ -->
        <div class="mb-4 p-3 bg-blue-50 rounded-lg border border-blue-200">
            <div class="text-xs font-semibold text-blue-700 mb-2">é€‰æ‹©è¦è¿˜åŸçš„æ•°æ®</div>
            <div class="space-y-1.5">
                <!-- é»˜è®¤å‹¾é€‰ -->
                <label
                    class="flex items-center gap-2 text-xs text-gray-700 cursor-pointer hover:bg-white/50 p-1 rounded">
                    <input type="checkbox" name="restore_configs" checked class="rounded">
                    <span class="font-medium">å…¨å±€é…ç½®</span>
                    <span class="text-gray-500">(qBittorrentã€Bangumiç­‰è®¾ç½®)</span>
                </label>
                <label
                    class="flex items-center gap-2 text-xs text-gray-700 cursor-pointer hover:bg-white/50 p-1 rounded">
                    <input type="checkbox" name="restore_metadata" checked class="rounded">
                    <span class="font-medium">å…ƒæ•°æ®ä¸æµ·æŠ¥</span>
                    <span class="text-gray-500">(åŠ¨æ¼«ä¿¡æ¯å’Œå›¾ç‰‡ç¼“å­˜)</span>
                </label>

                <!-- é»˜è®¤ä¸å‹¾é€‰ -->
                <label
                    class="flex items-center gap-2 text-xs text-gray-700 cursor-pointer hover:bg-white/50 p-1 rounded">
                    <input type="checkbox" name="restore_subscriptions" class="rounded">
                    <span>è®¢é˜…é…ç½®</span>
                    <span class="text-gray-500">({{ .Stats.SubscriptionCount }} ä¸ª)</span>
                </label>
                <label
                    class="flex items-center gap-2 text-xs text-gray-700 cursor-pointer hover:bg-white/50 p-1 rounded">
                    <input type="checkbox" name="restore_logs" class="rounded">
                    <span>ä¸‹è½½æ—¥å¿—</span>
                    <span class="text-gray-500">({{ .Stats.DownloadLogCount }} æ¡)</span>
                </label>
                <label
                    class="flex items-center gap-2 text-xs text-gray-700 cursor-pointer hover:bg-white/50 p-1 rounded">
                    <input type="checkbox" name="restore_local" class="rounded">
                    <span>æœ¬åœ°åŠ¨æ¼«æ•°æ®</span>
                    <span class="text-gray-500">({{ .Stats.LocalAnimeCount }} ä¸ª)</span>
                </label>
            </div>
        </div>

        <div class="bg-amber-50 border border-amber-200 rounded-lg p-3 mb-4">
            <div class="flex items-start gap-2">
                <span class="text-lg">âš ï¸</span>
                <div class="text-xs text-amber-700">
                    <div class="font-semibold mb-1">æ³¨æ„äº‹é¡¹</div>
                    <ul class="list-disc list-inside space-y-0.5 text-amber-600">
                        <li>å·²å‹¾é€‰çš„è¡¨å°†è¢«å¤‡ä»½æ–‡ä»¶ä¸­çš„æ•°æ®<strong>å®Œå…¨æ›¿æ¢</strong></li>
                        <li>æœªå‹¾é€‰çš„è¡¨ä¿æŒå½“å‰çŠ¶æ€ä¸å˜</li>
                        <li>æ­¤æ“ä½œä¸å¯é€†ï¼Œå»ºè®®å…ˆå¤‡ä»½å½“å‰æ•°æ®</li>
                    </ul>
                </div>
            </div>
        </div>

        <button type="submit" id="confirm-btn"
            class="w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition shadow flex items-center justify-center gap-2 font-semibold">
            <span class="[.htmx-request_&]:hidden">ğŸš€ ç¡®è®¤è¿˜åŸé€‰ä¸­æ•°æ®</span>
            <span class="hidden [.htmx-request_&]:inline animate-spin">âŒ› è¿˜åŸä¸­...</span>
        </button>
    </form>
</div>
{{ end }}